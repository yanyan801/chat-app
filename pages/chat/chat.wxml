<!--pages/chat/chat.wxml-->
<view class="chat-container">
    <scroll-view class="messages-area" scroll-y scroll-into-view="{{toView}}" scroll-with-animation>
        <block wx:if="{{messages.length === 0}}">
            <view class="empty-state">
                <text class="empty-text">å®—å¸ˆæ­£åœ¨æ‰“å...</text>
                <text class="empty-text">æœ‰ä»€ä¹ˆæƒ³é—®çš„å—ï¼Ÿ</text>
            </view>
        </block>

        <block wx:for="{{messages}}" wx:key="index">
            <view class="message-row {{item.role === 'user' ? 'user-row' : 'bot-row'}}" id="msg-{{index}}">
                <view class="avatar {{item.role === 'user' ? 'user-avatar' : 'bot-avatar'}}">
                    <text>{{item.role === 'user' ? 'ğŸ‘¤' : 'ğŸ¥£'}}</text>
                </view>
                <view class="bubble {{item.role === 'user' ? 'user-bubble' : 'bot-bubble'}}">
                    <text>{{item.content}}</text>
                </view>
            </view>
        </block>

        <view wx:if="{{isLoading}}" class="message-row bot-row">
            <view class="avatar bot-avatar">
                <text>ğŸ¥£</text>
            </view>
            <view class="bubble bot-bubble loading-bubble">
                <text>å®—å¸ˆæ€è€ƒä¸­...</text>
            </view>
        </view>

        <view id="bottom-anchor" style="height: 20rpx;"></view>
    </scroll-view>

    <view class="input-area">
        <view class="input-box">
            <input class="input" value="{{inputValue}}" bindinput="onInput" bindconfirm="sendMessage" confirm-type="send" placeholder="é—®ç‚¹ä»€ä¹ˆ..." disabled="{{isLoading}}" />
            <view class="send-btn {{inputValue ? 'active' : ''}}" bindtap="sendMessage">
                <text>â¤</text>
            </view>
        </view>
    </view>
</view>